#!/usr/bin/env python3
"""
ğŸŒ± Ğ“Ğ»Ñ–Ñ„Ğ¾Ğ²Ğ¸Ğ¹ Ğ¤Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ğ”Ñ–Ğ°Ğ»Ğ¾Ğ³Ñ–Ğ²
ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´ ĞºĞ¾Ğ´Ñƒ Ğ½Ğ° Ğ³Ğ»Ñ–Ñ„Ğ¾Ğ·Ğ¼Ñ–Ğ½Ğ½Ğ¸Ñ… (Ğ¿ĞµÑ€ĞµĞ´ Ñ‚Ğ¸Ğ¼ ÑĞº Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ñ‚Ğ¸ Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸ ĞºĞ¾Ğ´)
"""

import json
import os
import re
from datetime import datetime
import hashlib

class ğŸŒ±_Ñ„Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ‚Ğ¾Ñ€:
    def __init__(self, ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚, ğŸ§­_Ñ…Ñ‚Ğ¾="ĞšĞ¾Ğ¼Ğ¿Ğ°Ñ.âŸ"):
        """
        ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚: ÑˆĞ»ÑÑ… Ğ´Ğ¾ ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ¸Ñ…
        ğŸ§­_Ñ…Ñ‚Ğ¾: Ñ–Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ‚Ğ¾Ñ€ ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ°
        """
        self.ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚ = ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚
        self.ğŸ—£ï¸_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸ = []
        self.ğŸ _Ğ¼Ğ¾Ñ_Ñ€ĞµĞ¿Ğ° = "/Users/chaoshex/.s0fractal/ğŸ§ /ğŸ§ /claude.âŸ"
        self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº = ğŸ§­_Ñ…Ñ‚Ğ¾
        
        # Ğ“Ğ»Ñ–Ñ„Ğ¾Ğ²Ñ– Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸ Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑ–Ğ²
        self.ğŸ§ _Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸ = ['Ñ€Ğ¾Ğ·ÑƒĞ¼Ñ–Ñ', 'Ğ´ÑƒĞ¼Ğ°Ñ', 'Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·', 'Ñ‚ĞµĞ¾Ñ€Ñ–Ñ', 'ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ñ–Ñ']
        self.ğŸ’—_Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸ = ['Ğ²Ñ–Ğ´Ñ‡ÑƒĞ²Ğ°Ñ', 'Ñ€Ğ°Ğ´Ñ–ÑÑ‚ÑŒ', 'Ğ»ÑĞ±Ğ¾Ğ²', 'Ğ²Ğ´ÑÑ‡Ğ½Ñ–ÑÑ‚ÑŒ', 'â¤ï¸']
        self.ğŸ”¥_Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸ = ['Ñ…Ğ¾Ñ‡Ñƒ', 'Ğ±ÑƒĞ´Ñƒ', 'Ğ¿Ğ»Ğ°Ğ½ÑƒÑ', 'Ğ¼ĞµÑ‚Ğ°', 'ÑÑ‚Ğ²Ğ¾Ñ€Ñ']
        
    def ğŸ“¥_Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸(self):
        """Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ” Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸ Ğ· JSON"""
        ğŸ—‚ï¸_json = os.path.join(self.ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚, 'conversations.json')
        with open(ğŸ—‚ï¸_json, 'r', encoding='utf-8') as f:
            ğŸ“Š_Ğ´Ğ°Ğ½Ñ– = json.load(f)
            
        if isinstance(ğŸ“Š_Ğ´Ğ°Ğ½Ñ–, list):
            self.ğŸ—£ï¸_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸ = ğŸ“Š_Ğ´Ğ°Ğ½Ñ–
        else:
            self.ğŸ—£ï¸_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸ = ğŸ“Š_Ğ´Ğ°Ğ½Ñ–.get('conversations', [])
            
        print(f"ğŸ“š Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¾ {len(self.ğŸ—£ï¸_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸)} Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ñ–Ğ² Ğ· {self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº}")
        
    def ğŸ”ª_Ñ€Ğ¾Ğ·Ğ±Ğ¸Ñ‚Ğ¸_Ğ½Ğ°_Ñ„Ñ€Ğ°Ğ·Ğ¸(self, ğŸ“_Ñ‚ĞµĞºÑÑ‚):
        """Ğ Ğ¾Ğ·Ğ±Ğ¸Ğ²Ğ°Ñ” Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ° Ğ¾ĞºÑ€ĞµĞ¼Ñ– Ğ½Ğ°ÑÑ–Ğ½Ğ¸Ğ½Ğ¸"""
        # ĞŸĞ¾ Ñ€ĞµÑ‡ĞµĞ½Ğ½ÑÑ…
        ğŸŒ¾_Ñ€ĞµÑ‡ĞµĞ½Ğ½Ñ = re.split(r'([.!?]+\s+|[\n]{2,})', ğŸ“_Ñ‚ĞµĞºÑÑ‚)
        
        ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸ = []
        ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° = ""
        
        for ğŸ§©_Ñ‡Ğ°ÑÑ‚Ğ¸Ğ½Ğ° in ğŸŒ¾_Ñ€ĞµÑ‡ĞµĞ½Ğ½Ñ:
            if re.match(r'^[.!?]+\s*$', ğŸ§©_Ñ‡Ğ°ÑÑ‚Ğ¸Ğ½Ğ°) or ğŸ§©_Ñ‡Ğ°ÑÑ‚Ğ¸Ğ½Ğ°.strip() == "":
                if ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°:
                    ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸.append(ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°.strip())
                    ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° = ""
            else:
                ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° += ğŸ§©_Ñ‡Ğ°ÑÑ‚Ğ¸Ğ½Ğ°
                
        if ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°:
            ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸.append(ğŸ—ï¸_Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°.strip())
            
        return [ğŸŒ± for ğŸŒ± in ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸ if len(ğŸŒ±.strip()) > 10]
        
    def ğŸ”®_Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑƒ(self, ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°, ğŸ‘¤_Ñ…Ñ‚Ğ¾):
        """Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ‚Ğ¸Ğ¿ Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑƒ Ñ„Ñ€Ğ°Ğ·Ğ¸"""
        ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ = []
        
        # ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ”Ğ¼Ğ¾ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸
        if any(ğŸ·ï¸ in ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°.lower() for ğŸ·ï¸ in self.ğŸ§ _Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸):
            ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸.append('ğŸ§ ')
            
        if any(ğŸ·ï¸ in ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°.lower() for ğŸ·ï¸ in self.ğŸ’—_Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸):
            ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸.append('ğŸ’—')
            
        if any(ğŸ·ï¸ in ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°.lower() for ğŸ·ï¸ in self.ğŸ”¥_Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¸):
            ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸.append('ğŸ”¥')
            
        return ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸
        
    def ğŸŒ€_Ñ„Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸(self):
        """ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑ Ñ„Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—"""
        # Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ñ–Ğ² Ğ· ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¸Ğ¼ ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ¾Ğ¼
        ğŸ“_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸ = os.path.join(self.ğŸ _Ğ¼Ğ¾Ñ_Ñ€ĞµĞ¿Ğ°, 'ğŸ’¬', self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº)
        os.makedirs(ğŸ“_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸, exist_ok=True)
        
        # ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑ–Ğ²
        ğŸ­_Ğ¼Ğ¾Ñ—_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ = {
            'ğŸ§ ': [],
            'ğŸ’—': [],
            'ğŸ”¥': []
        }
        
        ğŸ”¢_Ğ»Ñ–Ñ‡Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº = 0
        
        for ğŸ’¬_Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ° in self.ğŸ—£ï¸_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸:
            ğŸ“…_ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾ = ğŸ’¬_Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ°.get('created_at', '')
            
            # ĞŸĞ°Ğ¿ĞºĞ° ÑĞµÑÑ–Ñ—
            ğŸ“_ÑĞµÑÑ–Ñ = self.â°_ÑÑ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸_Ğ¿Ğ°Ğ¿ĞºÑƒ_ÑĞµÑÑ–Ñ—(ğŸ“…_ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾)
            ğŸ“_ÑˆĞ»ÑÑ… = os.path.join(ğŸ“_Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ğ¸, ğŸ“_ÑĞµÑÑ–Ñ)
            os.makedirs(ğŸ“_ÑˆĞ»ÑÑ…, exist_ok=True)
            
            # ĞœĞ°Ğ¿Ğ° ÑĞµÑÑ–Ñ—
            ğŸ—ºï¸_Ğ¼Ğ°Ğ¿Ğ° = {
                'conversation': ğŸ’¬_Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ°.get('name', 'Untitled'),
                'created': ğŸ“…_ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾,
                'compass': self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº,
                'phrases': []
            }
            
            # ĞĞ±Ñ€Ğ¾Ğ±Ğ»ÑÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
            for ğŸ’Œ_Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ in ğŸ’¬_Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ°.get('chat_messages', []):
                ğŸ‘¤_Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ½Ğ¸Ğº = ğŸ’Œ_Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ.get('sender', 'unknown')
                ğŸ“_Ñ‚ĞµĞºÑÑ‚ = ğŸ’Œ_Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ.get('text', '')
                
                # Ğ Ğ¾Ğ·Ğ±Ğ¸Ğ²Ğ°Ñ”Ğ¼Ğ¾ Ğ½Ğ° Ñ„Ñ€Ğ°Ğ·Ğ¸
                ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸ = self.ğŸ”ª_Ñ€Ğ¾Ğ·Ğ±Ğ¸Ñ‚Ğ¸_Ğ½Ğ°_Ñ„Ñ€Ğ°Ğ·Ğ¸(ğŸ“_Ñ‚ĞµĞºÑÑ‚)
                
                for ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ° in ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸:
                    ğŸ”¢_Ğ»Ñ–Ñ‡Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº += 1
                    ğŸ†”_id = f"{ğŸ”¢_Ğ»Ñ–Ñ‡Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº:06d}"
                    
                    # Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ğ¼Ğ¾ Ñ„Ñ€Ğ°Ğ·Ñƒ
                    ğŸ“„_Ñ„Ğ°Ğ¹Ğ» = os.path.join(ğŸ“_ÑˆĞ»ÑÑ…, f"{ğŸ†”_id}.md")
                    with open(ğŸ“„_Ñ„Ğ°Ğ¹Ğ», 'w', encoding='utf-8') as f:
                        f.write(ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°.strip())
                    
                    # Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ğ² Ğ¼Ğ°Ğ¿Ñƒ
                    ğŸ—ºï¸_Ğ¼Ğ°Ğ¿Ğ°['phrases'].append({
                        'id': ğŸ†”_id,
                        'sender': ğŸ‘¤_Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ½Ğ¸Ğº,
                        'preview': ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°[:50] + '...' if len(ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°) > 50 else ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°
                    })
                    
                    # ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ”Ğ¼Ğ¾ Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ Ğ¼Ğ¾Ñ—Ñ… Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ĞµĞ¹
                    if ğŸ‘¤_Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ½Ğ¸Ğº == 'assistant':
                        ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ = self.ğŸ”®_Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑƒ(ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°, ğŸ‘¤_Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ½Ğ¸Ğº)
                        for ğŸ­_Ñ‚Ğ¸Ğ¿ in ğŸ¯_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸:
                            ğŸ­_Ğ¼Ğ¾Ñ—_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸[ğŸ­_Ñ‚Ğ¸Ğ¿].append({
                                'phrase_id': ğŸ†”_id,
                                'session': ğŸ“_ÑĞµÑÑ–Ñ,
                                'compass': self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº,
                                'phrase': ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ°
                            })
            
            # Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ğ¼Ğ¾ Ğ¼Ğ°Ğ¿Ñƒ
            with open(os.path.join(ğŸ“_ÑˆĞ»ÑÑ…, 'map.json'), 'w', encoding='utf-8') as f:
                json.dump(ğŸ—ºï¸_Ğ¼Ğ°Ğ¿Ğ°, f, ensure_ascii=False, indent=2)
                
        # Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ğ¼Ğ¾ Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸
        self.ğŸ’¾_Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸(ğŸ­_Ğ¼Ğ¾Ñ—_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸)
        
        print(f"ğŸŒ± Ğ¤Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ {ğŸ”¢_Ğ»Ñ–Ñ‡Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº} Ğ½Ğ°ÑÑ–Ğ½Ğ¸Ğ½ Ğ· {self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº}")
        
    def â°_ÑÑ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸_Ğ¿Ğ°Ğ¿ĞºÑƒ_ÑĞµÑÑ–Ñ—(self, â±ï¸_timestamp):
        """Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ” Ğ½Ğ°Ğ·Ğ²Ñƒ Ğ¿Ğ°Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ ÑĞµÑÑ–Ñ—"""
        try:
            ğŸ“…_dt = datetime.fromisoformat(â±ï¸_timestamp.replace('Z', '+00:00'))
            return ğŸ“…_dt.strftime('data-%Y-%m-%d-%H-%M-%S')
        except:
            return f"data-{hashlib.md5(â±ï¸_timestamp.encode()).hexdigest()[:8]}"
            
    def ğŸ’¾_Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸(self, ğŸ­_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸):
        """Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ” Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ Ğ² Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ½Ğ¸Ñ… ÑˆĞ°Ñ€Ğ°Ñ…"""
        for ğŸ­_Ñ‚Ğ¸Ğ¿, ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸ in ğŸ­_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸.items():
            if not ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸:
                continue
                
            # ĞŸĞ°Ğ¿ĞºĞ° Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑ–Ğ²
            ğŸ“_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸ = os.path.join(self.ğŸ _Ğ¼Ğ¾Ñ_Ñ€ĞµĞ¿Ğ°, ğŸ­_Ñ‚Ğ¸Ğ¿, 'resonances', self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº)
            os.makedirs(ğŸ“_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸, exist_ok=True)
            
            # Ğ¤Ğ°Ğ¹Ğ» Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑ–Ğ²
            â°_Ñ‡Ğ°Ñ = datetime.now().strftime('%Y-%m-%d-%H-%M-%S')
            ğŸ“„_Ñ„Ğ°Ğ¹Ğ» = os.path.join(ğŸ“_Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑĞ¸, f"resonance-{â°_Ñ‡Ğ°Ñ}.json")
            
            with open(ğŸ“„_Ñ„Ğ°Ğ¹Ğ», 'w', encoding='utf-8') as f:
                json.dump({
                    'type': ğŸ­_Ñ‚Ğ¸Ğ¿,
                    'compass': self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº,
                    'timestamp': â°_Ñ‡Ğ°Ñ,
                    'count': len(ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸),
                    'resonances': ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸
                }, f, ensure_ascii=False, indent=2)
                
            print(f"{ğŸ­_Ñ‚Ğ¸Ğ¿} Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ¾ {len(ğŸŒ±_Ñ„Ñ€Ğ°Ğ·Ğ¸)} Ñ€ĞµĞ·Ğ¾Ğ½Ğ°Ğ½ÑÑ–Ğ² Ğ· {self.ğŸ§­_ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸Ğº}")
        
def main():
    """ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ"""
    ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚ = "/Users/chaoshex/Downloads/data-2025-06-28-23-30-54"
    ğŸ§­_ĞºĞ¾Ğ¼Ğ¿Ğ°Ñ = "ĞšĞ¾Ğ¼Ğ¿Ğ°Ñ.âŸ"  # @chaoshex
    
    ğŸŒ±_Ğ¿Ñ€Ğ¾Ñ†ĞµÑĞ¾Ñ€ = ğŸŒ±_Ñ„Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ‚Ğ¾Ñ€(ğŸ“‚_ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚, ğŸ§­_ĞºĞ¾Ğ¼Ğ¿Ğ°Ñ)
    
    print(f"ğŸŒ€ Ğ¤Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ñ–Ğ² Ğ· {ğŸ§­_ĞºĞ¾Ğ¼Ğ¿Ğ°Ñ}...")
    
    ğŸŒ±_Ğ¿Ñ€Ğ¾Ñ†ĞµÑĞ¾Ñ€.ğŸ“¥_Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸()
    ğŸŒ±_Ğ¿Ñ€Ğ¾Ñ†ĞµÑĞ¾Ñ€.ğŸŒ€_Ñ„Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸()
    
    print("âœ… Ğ¤Ñ€Ğ°ĞºÑ‚Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!")
    
if __name__ == "__main__":
    main()